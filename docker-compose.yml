services:
  # 1. 后端服务 (FastAPI)
  backend:
    build: .
    container_name: familycoin-backend
    command: uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./data:/app/data
      - ./backend:/app/backend
      - ./shared:/app/shared
    # 新增: 通过 environment 块设置环境变量
    environment:
      - ADMIN_SECRET_KEY=JIEFANGJUNISKING # <- 在这里设置你复杂的新密码
      - GENESIS_PASSWORD=babamama # <- 在这里设置你复杂的新密码
    networks:
      - familycoin-net

  # 2. 前端服务 (Streamlit)
  frontend:
    build: .
    container_name: familycoin-frontend
    command: streamlit run frontend/app.py --server.port 8501 --server.address 0.0.0.0
    ports:
      - "8501:8501"
    volumes:
      - ./frontend:/app/frontend
      - ./shared:/app/shared
    environment:
      - BACKEND_URL=http://backend:8000
      - PYTHONPATH=/app
      # 新增: 设置前端UI密码
      - ADMIN_UI_PASSWORD=j # <- 在这里设置你的UI解锁密码
    depends_on:
      - backend
    networks:
      - familycoin-net

networks:
  familycoin-net:
    driver: bridge