services:
  # 1. 后端服务 (FastAPI)
  backend:
    build: .
    container_name: familycoin-backend
    command: uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./data:/app/data
      - ./backend:/app/backend
      - ./shared:/app/shared
    environment:
      - ADMIN_SECRET_KEY=JIEFANGJUNISKING
      - GENESIS_PASSWORD=babamama
    networks:
      - familycoin-net

  # 2. 前端服务 (Vite 开发模式)
  frontend:
    image: node:20-alpine
    container_name: familycoin-frontend-vue-dev
    working_dir: /app
    # 【核心修正】在启动开发服务器前，先运行 npm install
    command: sh -c "npm install && npm run dev"
    ports:
      - "8501:5173"
    volumes:
      # 挂载本地代码以实现热重载
      - ./frontend-vue:/app
      # 【核心修正】使用匿名卷将容器内的 node_modules 目录独立出来，
      # 防止被本地的 node_modules 覆盖。
      - /app/node_modules
    networks:
      - familycoin-net
    depends_on:
      - backend

networks:
  familycoin-net:
    driver: bridge