services:
  # 1. 后端服务 (FastAPI) - 保持不变
  backend:
    build: .
    container_name: familycoin-backend
    command: uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./data:/app/data
      - ./backend:/app/backend
      - ./shared:/app/shared
    environment:
      - ADMIN_SECRET_KEY=JIEFANGJUNISKING
      - GENESIS_PASSWORD=babamama
    networks:
      - familycoin-net

  # 2. 前端服务 (Streamlit) - 【核心修改部分】
  frontend:
    # build 上下文现在指向新的 Vue 目录
    build:
      context: ./frontend-vue
      dockerfile: Dockerfile
    container_name: familycoin-frontend-vue # 建议改个名以示区分
    ports:
      # 将主机的 8501 端口映射到 Nginx 容器的 80 端口
      - "8501:80"
    # 【开发模式关键配置】
    # 我们将本地的 frontend-vue 目录挂载到容器中
    # 这样你修改代码时，Vite 的热重载 (HMR) 就能生效
    volumes:
      - ./frontend-vue:/app
      # 匿名卷，防止本地 node_modules 覆盖容器内的
      - /app/node_modules
    # 环境变量现在对 Nginx 意义不大，可以先移除或注释掉
    # environment:
    #   - BACKEND_URL=http://backend:8000
    depends_on:
      - backend
    networks:
      - familycoin-net

networks:
  familycoin-net:
    driver: bridge