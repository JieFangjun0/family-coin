services:
  # 1. 后端服务 (FastAPI)
  backend:
    build: .
    container_name: familycoin-backend
    command: uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./data:/app/data
      - ./backend:/app/backend
      - ./shared:/app/shared
    
    # +++ 核心修改：移除硬编码的密码 +++
    # 现在这些值将从根目录的 .env 文件中自动加载
    environment:
      - ADMIN_SECRET_KEY=${ADMIN_SECRET_KEY}
      - GENESIS_PASSWORD=${GENESIS_PASSWORD}
    # +++ 修改结束 +++

    networks:
      - familycoin-net

# 2. 前端服务 (Vite 开发模式)
  frontend:
    image: node:24-alpine
    container_name: familycoin-frontend-vue-dev
    working_dir: /app
    # 【核心修正】将 "npm install" 替换为更可靠的 "npm ci"
    command: sh -c "npm ci && npm run dev"
    ports:
      - "8501:5173"
    volumes:
      - ./frontend-vue:/app
      - /app/node_modules
    networks:
      - familycoin-net
    depends_on:
      - backend

networks:
  familycoin-net:
    driver: bridge